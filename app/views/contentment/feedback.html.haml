.jarring
  = @client.name
  Feedback Message Queue

= form_tag download_feedbacks_path do
  %input{:type => 'text', :name => :startat, :class => :dater, :value => ((Time.now - 1.month).strftime('01/%m/%Y'))}/
  to
  %input{:type => 'text', :name => :endat, :class => :dater, :value => (Time.now.strftime('01/%m/%Y'))}/
  %input{:type => 'submit', :value => 'Download Feedbacks'}/
%form{:action => send_messages_path}
  %input{:type => 'submit', :value => 'Send Now'}/
%table
  %thead
    %th Date
    %th To
    %th Message
    %th Tag
    %th Sent on
    %th System Response
  %tbody
    - @feedback.each do |msg|
      %tr{:class => 'respond' + (msg.sent_on ? ' ' : ' error')}
        %td
          = time_ago_in_words msg.created_at
          ago
          = surround '(', ')' do
            = msg.created_at
        %td
          - su  = SystemUser.find_by_number(msg.number)
          - sp  = Supervisor.find_by_number(msg.number)
          - if su then
            = su.name
            = surround '(', ')' do
              = msg.number
          - else
            - if sp then
              = sp.name
              = surround '[', ']' do
                = msg.number
            - else
              = msg.number
        %td
          = msg.message
        %td
          = msg.tag
        %td
          - if msg.sent_on then
            = msg.sent_on
            = surround '(', ')' do
              = time_ago_in_words msg.sent_on
              ago
        %td
          = msg.system_response
  %tfoot
    = will_paginate @feedback
